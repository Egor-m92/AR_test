<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js - Instant AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/ar.js@latest/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π AR –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        #arScene {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
        }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π overlay */
        #infoOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
        }

        .status-bar {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-red {
            background: #ff4757;
            box-shadow: 0 0 10px #ff4757;
        }

        .status-yellow {
            background: #ffa502;
            box-shadow: 0 0 10px #ffa502;
            animation: pulse 1s infinite;
        }

        .status-green {
            background: #2ed573;
            box-shadow: 0 0 10px #2ed573;
        }

        .status-blue {
            background: #3742fa;
            box-shadow: 0 0 10px #3742fa;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        .controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1001;
            pointer-events: auto;
        }

        .control-btn {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #2ed573;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }

        .loading-subtext {
            font-size: 14px;
            color: #aaa;
            text-align: center;
            max-width: 300px;
        }

        /* –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã */
        #cameraPermission {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2001;
            text-align: center;
            padding: 20px;
        }

        .permission-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .permission-text {
            font-size: 20px;
            margin-bottom: 10px;
            max-width: 400px;
        }

        .permission-subtext {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 30px;
            max-width: 400px;
        }

        .permission-btn {
            padding: 15px 40px;
            font-size: 18px;
            background: #2ed573;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        .permission-btn:hover {
            background: #26c464;
            transform: translateY(-2px);
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .hidden {
            display: none !important;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .instructions {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 14px;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .status-bar {
                top: 20px;
                left: 20px;
                right: 20px;
                max-width: none;
                font-size: 14px;
                padding: 12px 15px;
            }
            
            .controls {
                bottom: 20px;
                right: 20px;
                flex-direction: column;
            }
            
            .control-btn {
                padding: 12px 20px;
                min-width: 100px;
                font-size: 14px;
            }
            
            .instructions {
                bottom: 120px;
                left: 20px;
                right: 20px;
                max-width: none;
                font-size: 13px;
            }
        }

        /* –ú–∞—Ä–∫–µ—Ä –ø—Ä–µ–≤—å—é */
        #markerPreview {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            border: 2px solid #2ed573;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            pointer-events: none;
        }

        #markerPreview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <!-- –°—Ü–µ–Ω–∞ AR.js -->
    <a-scene id="arScene" embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="logarithmicDepthBuffer: true;" vr-mode-ui="enabled: false">
        
        <!-- –ú–∞—Ä–∫–µ—Ä –¥–ª—è AR -->
        <a-marker id="customMarker" type="pattern" url="data/pattern-marker.patt" vidhandler>
            <!-- –í–∏–¥–µ–æ –ø–æ–≤–µ—Ä—Ö –º–∞—Ä–∫–µ—Ä–∞ -->
            <a-video 
                id="arVideo"
                src="#videoAsset"
                width="1.6" 
                height="0.9" 
                position="0 0.5 0"
                rotation="-90 0 0"
                visible="false"
                material="shader: flat;"
                play-on-click>
            </a-video>
            
            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –º–∞—Ä–∫–µ—Ä–∞ -->
            <a-text 
                value="–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä" 
                position="0 -0.3 0" 
                align="center" 
                color="#FFF"
                scale="0.8 0.8 0.8">
            </a-text>
        </a-marker>
        
        <!-- –ö–∞–º–µ—Ä–∞ -->
        <a-entity camera></a-entity>
        
        <!-- –†–µ—Å—É—Ä—Å—ã -->
        <a-assets>
            <video id="videoAsset" src="" crossorigin="anonymous" preload="auto" loop playsinline webkit-playsinline></video>
        </a-assets>
        
    </a-scene>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π overlay -->
    <div id="infoOverlay">
        <div class="status-bar">
            <div class="status-indicator status-blue" id="statusIndicator"></div>
            <span id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ AR —Å–∏—Å—Ç–µ–º—ã...</span>
        </div>
        
        <div class="instructions">
            üìç –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –º–∞—Ä–∫–µ—Ä –∏–ª–∏ –ø–æ–∫–∞–∂–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ<br>
            üéØ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä<br>
            üé¨ –í–∏–¥–µ–æ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        </div>
        
        <div id="markerPreview">
            <img id="markerImage" crossorigin="anonymous" alt="–ú–∞—Ä–∫–µ—Ä">
        </div>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="controls">
        <button class="control-btn" onclick="toggleVideo()" id="playPauseBtn">
            ‚è∏Ô∏è –ü–∞—É–∑–∞
        </button>
        <button class="control-btn" onclick="restartVideo()">
            üîÑ –ó–∞–Ω–æ–≤–æ
        </button>
        <button class="control-btn" onclick="toggleDebug()" id="debugBtn">
            üîç –û—Ç–ª–∞–¥–∫–∞
        </button>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="loading">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR.js...</div>
        <div class="loading-subtext" id="loadingSubtext">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</div>
    </div>

    <!-- –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∫–∞–º–µ—Ä—É -->
    <div id="cameraPermission" class="hidden">
        <div class="permission-icon">üì∑</div>
        <div class="permission-text">–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</div>
        <div class="permission-subtext">
            –î–ª—è —Ä–∞–±–æ—Ç—ã AR –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–π –∫–∞–º–µ—Ä–µ. 
            –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ—Ä—É –≤ –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ.
        </div>
        <button class="permission-btn" onclick="requestCameraPermission()">
            –†–∞–∑—Ä–µ—à–∏—Ç—å –∫–∞–º–µ—Ä—É
        </button>
    </div>

    <script>
        // ==================== –í–ê–®–ò –î–ê–ù–ù–´–ï ====================
        // –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –î–ê–ù–ù–´–ï –ù–ê –°–í–û–ò
        
        // 1. –í–ê–® –ú–ê–†–ö–ï–† (Pattern —Ñ–∞–π–ª –¥–ª—è AR.js)
        // –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ pattern —Ñ–∞–π–ª–∞: https://jeromeetienne.github.io/AR.js/three.js/examples/marker-training/examples/generator.html
        const MY_MARKER_PATTERN = `assets/pattern-ar_photo.patt`;
        
        // 2. –í–ê–®–ï –í–ò–î–ï–û (URL)
        const MY_VIDEO_URL = 'assets/video.mp4';
        
        // 3. –í–ê–® –ú–ê–†–ö–ï–† –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï (–¥–ª—è –ø—Ä–µ–≤—å—é)
        const MY_MARKER_IMAGE = 'assets/ar_photo.jpg';

        // ==================== DOM –≠–õ–ï–ú–ï–ù–¢–´ ====================
        const loadingDiv = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const loadingSubtext = document.getElementById('loadingSubtext');
        const cameraPermissionDiv = document.getElementById('cameraPermission');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const debugBtn = document.getElementById('debugBtn');
        const markerImage = document.getElementById('markerImage');
        const arScene = document.getElementById('arScene');
        const arVideo = document.getElementById('arVideo');
        const videoAsset = document.getElementById('videoAsset');

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let isVideoPlaying = false;
        let isMarkerDetected = false;
        let debugMode = false;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async function() {
            console.log('üöÄ AR.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...');
            
            // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä–∫–µ—Ä–∞ –∏ –≤–∏–¥–µ–æ
            await loadResources();
            
            // 2. –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
            showCameraPermissionRequest();
        });

        // ==================== –ó–ê–ì–†–£–ó–ö–ê –†–ï–°–£–†–°–û–í ====================
        async function loadResources() {
            loadingText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...';
            
            try {
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–µ–æ
                videoAsset.src = MY_VIDEO_URL;
                await new Promise((resolve, reject) => {
                    videoAsset.onloadeddata = resolve;
                    videoAsset.onerror = reject;
                });
                
                console.log('‚úÖ –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–≤—å—é –º–∞—Ä–∫–µ—Ä–∞
                markerImage.src = MY_MARKER_IMAGE || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="black"/><text x="50" y="50" font-family="Arial" font-size="14" fill="white" text-anchor="middle" dy=".3em">AR –ú–∞—Ä–∫–µ—Ä</text></svg>';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤:', error);
                loadingText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                loadingSubtext.textContent = error.message;
            }
        }

        // ==================== –î–û–°–¢–£–ü –ö –ö–ê–ú–ï–†–ï ====================
        function showCameraPermissionRequest() {
            loadingDiv.style.display = 'none';
            cameraPermissionDiv.classList.remove('hidden');
        }

        async function requestCameraPermission() {
            loadingText.textContent = '–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...';
            loadingSubtext.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ';
            loadingDiv.style.display = 'flex';
            cameraPermissionDiv.classList.add('hidden');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∞–º–µ—Ä—ã
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
                }
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫, —Ç–∞–∫ –∫–∞–∫ AR.js —Å–∞–º –µ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç
                stream.getTracks().forEach(track => track.stop());
                
                console.log('‚úÖ –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º AR.js —Å–∏—Å—Ç–µ–º—É
                startARJS();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                loadingText.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ';
                loadingSubtext.textContent = error.message;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
                setTimeout(() => {
                    cameraPermissionDiv.classList.remove('hidden');
                    loadingDiv.style.display = 'none';
                }, 2000);
            }
        }

        // ==================== –ó–ê–ü–£–°–ö AR.JS ====================
        function startARJS() {
            loadingText.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR.js...';
            loadingSubtext.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ü–µ–Ω—ã';
            
            // –°–æ–∑–¥–∞–µ–º pattern —Ñ–∞–π–ª –º–∞—Ä–∫–µ—Ä–∞
            createMarkerPattern();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Ü–µ–Ω—É
            setupARScene();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã (–¥–∞–µ–º –≤—Ä–µ–º—è AR.js –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é)
            setTimeout(() => {
                loadingDiv.style.opacity = '0';
                setTimeout(() => {
                    loadingDiv.style.display = 'none';
                    loadingDiv.style.opacity = '1';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    statusIndicator.className = 'status-indicator status-blue';
                    statusText.textContent = '–ì–æ—Ç–æ–≤–æ! –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä';
                    
                }, 500);
            }, 2000);
        }

        function createMarkerPattern() {
            // –°–æ–∑–¥–∞–µ–º blob –∏–∑ pattern –¥–∞–Ω–Ω—ã—Ö
            const blob = new Blob([MY_MARKER_PATTERN], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
            const marker = document.getElementById('customMarker');
            marker.setAttribute('url', url);
            
            console.log('‚úÖ Pattern —Ñ–∞–π–ª –º–∞—Ä–∫–µ—Ä–∞ —Å–æ–∑–¥–∞–Ω');
        }

        function setupARScene() {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º–∞—Ä–∫–µ—Ä–∞
            const marker = document.getElementById('customMarker');
            
            // –ö–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω
            marker.addEventListener('markerFound', function() {
                console.log('üéØ –ú–∞—Ä–∫–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω!');
                isMarkerDetected = true;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
                arVideo.setAttribute('visible', 'true');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ
                const video = document.querySelector('#videoAsset');
                video.play().then(() => {
                    isVideoPlaying = true;
                    playPauseBtn.innerHTML = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                }).catch(error => {
                    console.warn('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', error);
                    video.muted = true;
                    video.play();
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                statusIndicator.className = 'status-indicator status-green';
                statusText.textContent = '–í–∏–¥–µ–æ –∞–∫—Ç–∏–≤–Ω–æ ‚úì';
            });
            
            // –ö–æ–≥–¥–∞ –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω
            marker.addEventListener('markerLost', function() {
                console.log('‚ö†Ô∏è –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                isMarkerDetected = false;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
                arVideo.setAttribute('visible', 'false');
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ
                const video = document.querySelector('#videoAsset');
                video.pause();
                isVideoPlaying = false;
                playPauseBtn.innerHTML = '‚ñ∂Ô∏è –í–æ—Å–ø—Ä.';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                statusIndicator.className = 'status-indicator status-blue';
                statusText.textContent = '–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä';
            });
            
            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ –ø–æ –∫–ª–∏–∫—É
            AFRAME.registerComponent('play-on-click', {
                init: function () {
                    this.onClick = this.onClick.bind(this);
                    this.el.addEventListener('click', this.onClick);
                },
                onClick: function (evt) {
                    const video = this.el.components.material.material.map.image;
                    
                    if (!video) return;
                    
                    if (video.paused) {
                        video.play();
                        isVideoPlaying = true;
                        playPauseBtn.innerHTML = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                    } else {
                        video.pause();
                        isVideoPlaying = false;
                        playPauseBtn.innerHTML = '‚ñ∂Ô∏è –í–æ—Å–ø—Ä.';
                    }
                }
            });
            
            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ
            AFRAME.registerComponent('vidhandler', {
                init: function () {
                    this.toggle = false;
                    this.vid = document.querySelector("#videoAsset");
                    this.vid.pause();
                }
            });
            
            console.log('‚úÖ AR.js —Å—Ü–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ò–î–ï–û ====================
        function toggleVideo() {
            if (!isMarkerDetected) return;
            
            const video = document.querySelector('#videoAsset');
            if (!video) return;
            
            if (isVideoPlaying) {
                video.pause();
                playPauseBtn.innerHTML = '‚ñ∂Ô∏è –í–æ—Å–ø—Ä.';
                isVideoPlaying = false;
            } else {
                video.play().then(() => {
                    playPauseBtn.innerHTML = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                    isVideoPlaying = true;
                }).catch(error => {
                    console.warn('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                });
            }
        }

        function restartVideo() {
            if (!isMarkerDetected) return;
            
            const video = document.querySelector('#videoAsset');
            if (!video) return;
            
            video.currentTime = 0;
            if (!isVideoPlaying) {
                video.play();
                isVideoPlaying = true;
                playPauseBtn.innerHTML = '‚è∏Ô∏è –ü–∞—É–∑–∞';
            }
        }

        function toggleDebug() {
            debugMode = !debugMode;
            
            // –í–∫–ª—é—á–∞–µ–º/–≤—ã–∫–ª—é—á–∞–µ–º debug UI AR.js
            const arjs = arScene.getAttribute('arjs');
            if (debugMode) {
                arjs.debugUIEnabled = true;
                debugBtn.innerHTML = 'üëÅÔ∏è‚Äçüó®Ô∏è –û–±—ã—á–Ω—ã–π';
            } else {
                arjs.debugUIEnabled = false;
                debugBtn.innerHTML = 'üîç –û—Ç–ª–∞–¥–∫–∞';
            }
            
            arScene.setAttribute('arjs', arjs);
        }

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ô –î–û–°–¢–£–ü ====================
        window.requestCameraPermission = requestCameraPermission;
        window.toggleVideo = toggleVideo;
        window.restartVideo = restartVideo;
        window.toggleDebug = toggleDebug;

        // ==================== –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö ====================
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ AR.js
        arScene.addEventListener('arjs-video-loaded', function() {
            console.log('‚úÖ –í–∏–¥–µ–æ AR.js –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
        });

        arScene.addEventListener('error', function(error) {
            console.error('–û—à–∏–±–∫–∞ AR.js:', error);
            statusIndicator.className = 'status-indicator status-red';
            statusText.textContent = '–û—à–∏–±–∫–∞ AR —Å–∏—Å—Ç–µ–º—ã';
        });

        // ==================== –û–ë–†–ê–ë–û–¢–ö–ê –í–´–•–û–î–ê ====================
        window.addEventListener('beforeunload', function() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ
            const video = document.querySelector('#videoAsset');
            if (video) {
                video.pause();
                video.currentTime = 0;
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É —á–µ—Ä–µ–∑ AR.js
            const scene = document.querySelector('a-scene');
            if (scene && scene.systems && scene.systems.arjs) {
                scene.systems.arjs._stopCamera();
            }
        });

        // ==================== –ü–û–ú–û–©–¨ –ü–û –ú–ê–†–ö–ï–†–£ ====================
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ pattern —Ñ–∞–π–ª–∞
        function generateMarkerPattern() {
            console.log(`
            üìù –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ pattern —Ñ–∞–π–ª–∞:
            
            1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞: https://jeromeetienne.github.io/AR.js/three.js/examples/marker-training/examples/generator.html
            
            2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞
            
            3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
               - Pattern ratio: 0.5
               - Image size: 512
               
            4. –ù–∞–∂–º–∏—Ç–µ "Download Pattern"
            
            5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ .patt –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é MY_MARKER_PATTERN
            
            6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ (–ø–æ—è–≤–∏—Ç—Å—è –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)
               –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –∫–∞–∫ MY_MARKER_IMAGE
            
            ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ú–∞—Ä–∫–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—Å–æ–∫–æ–∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–º –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º!
            `);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª–∏
        console.log(`
        =============================================
        üéØ AR.js –ü–†–ò–õ–û–ñ–ï–ù–ò–ï - –ò–ù–°–¢–†–£–ö–¶–ò–Ø
        =============================================
        
        –î–ï–ô–°–¢–í–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
        1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—Å—è –∫–∞–º–µ—Ä–∞
        2. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
        3. –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä
        4. –í–∏–¥–µ–æ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        
        –ù–ê–°–¢–†–û–ô–ö–ê –ú–ê–†–ö–ï–†–ê:
        1. –ó–∞–º–µ–Ω–∏—Ç–µ MY_MARKER_PATTERN –Ω–∞ –≤–∞—à pattern
        2. –ó–∞–º–µ–Ω–∏—Ç–µ MY_VIDEO_URL –Ω–∞ –≤–∞—à–µ –≤–∏–¥–µ–æ
        3. –ó–∞–º–µ–Ω–∏—Ç–µ MY_MARKER_IMAGE –Ω–∞ –ø—Ä–µ–≤—å—é –º–∞—Ä–∫–µ—Ä–∞
        
        –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ú–ê–†–ö–ï–†–ê:
        –í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–∑–æ–≤–∏—Ç–µ: generateMarkerPattern()
        
        =============================================
        `);
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
        window.generateMarkerPattern = generateMarkerPattern;
    </script>
</body>
</html>